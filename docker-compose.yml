services:
  portal:
    build:
      context: .
      dockerfile_inline: |
        FROM node:22-alpine
        RUN apk add --no-cache bash docker-cli git
        WORKDIR /paas/portal
    image: paas-portal:local
    container_name: paas-portal
    working_dir: /paas/portal
    command: sh -c "npm ci && npm start"
    restart: unless-stopped
    init: true
    ports:
      - "3000:3000"
    environment:
      - PAAS_HOST_ROOT=${PWD}
    volumes:
      - ./:/paas
      - portal_node_modules:/paas/portal/node_modules
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - proxy

networks:
  proxy:
    external: true
    name: proxy

volumes:
  portal_node_modules:
